ÙŠØ§ Ø³Ù„Ø§Ù…! ÙÙƒØ±Ø© Ù…Ù…ØªØ§Ø²Ø© ÙˆÙ…Ø·Ù„ÙˆØ¨Ø© Ø¬Ø¯Ø§Ù‹. ØªØ·ÙˆÙŠØ± Ø¨ÙˆØª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø´ÙƒÙ„ Ù‡Ùˆ Ù…Ø´Ø±ÙˆØ¹ Ù…ÙÙŠØ¯. Ø³Ø£Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙˆØ§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù„Ø§Ø²Ù… Ù„Ø°Ù„Ùƒ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Node.jsØŒ TelegrafØŒ MongooseØŒ Ùˆ Google Drive API.

Ù†Ø¸Ø±Ù‹Ø§ Ù„Ø£Ù† Ù‡Ø°Ø§ Ù…Ø´Ø±ÙˆØ¹ Ù…ØªÙƒØ§Ù…Ù„ ÙˆÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¹Ø¯Ø© Ø®Ø·ÙˆØ§ØªØŒ Ø³Ø£Ù‚ÙˆÙ… Ø¨ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¥Ù„Ù‰ Ø£Ø¬Ø²Ø§Ø¡ Ø±Ø¦ÙŠØ³ÙŠØ© Ù…Ø¹ Ø´Ø±Ø­ ÙƒÙ„ Ø¬Ø²Ø¡.

**Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡:**

1.  **Ø­Ø³Ø§Ø¨ Telegram BotFather:** Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙˆØª ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Toke Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡.
2.  **Ø­Ø³Ø§Ø¨ Google Cloud Platform:** Ù„ØªÙ…ÙƒÙŠÙ† Google Drive API ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ (credentials.json) Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Drive.
3.  **Ø¨ÙŠØ¦Ø© Node.js:** Ù…Ø«Ø¨ØªØ© Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ.
4.  **MongoDB Atlas Ø£Ùˆ MongoDB Ù…Ø­Ù„ÙŠ:** Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.

---

### Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆØ§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:

*   **Node.js:** Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ´ØºÙŠÙ„.
*   **Telegraf:** Ø¥Ø·Ø§Ø± Ø¹Ù…Ù„ (framework) Ù„Ø¨Ù†Ø§Ø¡ Ø¨ÙˆØªØ§Øª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù….
*   **Mongoose:** Ù…ÙƒØªØ¨Ø© ODM (Object Data Modeling) Ù„Ù€ MongoDBØŒ ØªØ¨Ø³Ù‘Ø· Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª NoSQL.
*   **Googleapis (Google Drive API):** Ù„Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Google Drive.
*   **dotenv:** Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© (Ù…Ø«Ù„ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª ÙˆÙ…ÙØ§ØªÙŠØ­ Ø§Ù„Ù€ API).

---

### **Ø§Ù„Ø¬Ø²Ø¡ 1: Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹**

#### 1.1. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆØªÙ‡ÙŠØ¦Ø© Node.js:

```bash
mkdir telegram-lectures-bot
cd telegram-lectures-bot
npm init -y
```

#### 1.2. ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø©:

```bash
npm install telegraf mongoose googleapis dotenv
```

#### 1.3. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù `.env` (Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©):

Ø£Ù†Ø´Ø¦ Ù…Ù„ÙØ§Ù‹ Ø¨Ø§Ø³Ù… `.env` ÙÙŠ Ø¬Ø°Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆØ¶Ø¹ ÙÙŠÙ‡ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©. Ø³Ù†Ù‚ÙˆÙ… Ø¨Ù…Ù„Ø¦Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹.

```
BOT_TOKEN=YOUR_TELEGRAM_BOT_TOKEN
MONGO_URI=YOUR_MONGODB_CONNECTION_STRING
GOOGLE_DRIVE_CLIENT_ID=
GOOGLE_DRIVE_CLIENT_SECRET=
GOOGLE_DRIVE_REDIRECT_URI=
GOOGLE_DRIVE_REFRESH_TOKEN= # Ø³Ù†Ø­ØµÙ„ Ø¹Ù„ÙŠÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
GOOGLE_DRIVE_FOLDER_ID=YOUR_GOOGLE_DRIVE_FOLDER_ID # ID Ù„Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø°ÙŠ Ø³ØªØ®Ø²Ù† ÙÙŠÙ‡ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª
ADMIN_TELEGRAM_ID=YOUR_ADMIN_TELEGRAM_ID # Ø±Ù‚Ù… ØªØ¹Ø±ÙŠÙ Ø­Ø³Ø§Ø¨Ùƒ ÙÙŠ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… (ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„ÙŠÙ‡ Ù…Ù† @userinfobot)
```

**Ø´Ø±Ø­ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª:**

*   **`BOT_TOKEN`**: Ù…Ù† BotFather ÙÙŠ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù….
*   **`MONGO_URI`**: Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª MongoDB (Ù…Ø«Ø§Ù„: `mongodb+srv://user:pass@cluster.mongodb.net/lectures?retryWrites=true&w=majority`).
*   **`GOOGLE_DRIVE_CLIENT_ID`, `GOOGLE_DRIVE_CLIENT_SECRET`, `GOOGLE_DRIVE_REDIRECT_URI`**: Ù…Ù† Google Cloud Console (APIs & Services -> Credentials). Ø³ØªØ­ØªØ§Ø¬ Ù„Ø¥Ù†Ø´Ø§Ø¡ "OAuth 2.0 Client IDs" Ù…Ù† Ù†ÙˆØ¹ "Web application" ÙˆØªØ­Ø¯ÙŠØ¯ `http://localhost:3000/oauth2callback` (Ø£Ùˆ Ø£ÙŠ Ù…Ù†ÙØ° ØªØ­Ø¨Ù‡) ÙƒÙ€ "Authorized redirect URIs".
*   **`GOOGLE_DRIVE_REFRESH_TOKEN`**: Ù‡Ø°Ø§ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¹Ù…Ù„ÙŠØ© Ù…ØµØ§Ø¯Ù‚Ø© Ø£ÙˆÙ„ÙŠØ© (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©) Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„ÙŠÙ‡. Ø³Ø£Ø´Ø±Ø­ ÙƒÙŠÙ ÙÙŠ Ø¬Ø²Ø¡ Ù„Ø§Ø­Ù‚.
*   **`GOOGLE_DRIVE_FOLDER_ID`**: Ø§ÙØªØ­ Google DriveØŒ Ø£Ù†Ø´Ø¦ Ù…Ø¬Ù„Ø¯Ù‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§ Ù„Ù„Ù…Ø­Ø§Ø¶Ø±Ø§ØªØŒ Ø«Ù… Ø§Ù†Ø³Ø® Ø§Ù„Ù€ ID Ù…Ù† Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¬Ù„Ø¯ (Ù…Ø«Ø§Ù„: `https://drive.google.com/drive/folders/YOUR_FOLDER_ID_HERE`).
*   **`ADMIN_TELEGRAM_ID`**: Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¨ÙˆØª `@userinfobot` ÙÙŠ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…ØŒ Ø§Ø¶ØºØ· "Ø§Ø¨Ø¯Ø£" ÙˆØ³ÙŠØ¹Ø·ÙŠÙƒ Ø§Ù„Ù€ ID Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ.

---

### **Ø§Ù„Ø¬Ø²Ø¡ 2: Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Mongoose Models)**

Ø³Ù†Ø­ØªØ§Ø¬ Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠÙ†: `Class` Ùˆ `Lecture`.

Ø£Ù†Ø´Ø¦ Ù…Ù„ÙØ§Ù‹ Ø¨Ø§Ø³Ù… `models/index.js`:

```javascript
// models/index.js
const mongoose = require('mongoose');

const classSchema = new mongoose.Schema({
    name: {
        type: String,
        required: true,
        unique: true
    },
    description: String,
    lectures: [ // Ù…ØµÙÙˆÙØ© Ù„ØªØ®Ø²ÙŠÙ† Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„ØµÙ
        {
            type: mongoose.Schema.Types.ObjectId,
            ref: 'Lecture'
        }
    ]
}, { timestamps: true });

const lectureSchema = new mongoose.Schema({
    name: { // Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©ØŒ Ø³ÙŠØ£ØªÙŠ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù
        type: String,
        required: true
        // unique: true // Ù„Ø§ Ù†Ø¬Ø¹Ù„Ù‡ ÙØ±ÙŠØ¯Ø§Ù‹ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§ØªØŒ Ø¨Ù„ Ø¶Ù…Ù† Ø³ÙŠØ§Ù‚ Ø§Ù„ØµÙ
    },
    originalFileName: { // Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ Ø§Ù„Ù…Ø±Ø³Ù„ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        type: String,
        required: true
    },
    googleDriveId: { // ID Ø§Ù„Ù…Ù„Ù ÙÙŠ Google Drive
        type: String,
        required: true,
        unique: true
    },
    googleDriveLink: { // Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±)
        type: String,
        required: true
    },
    parentClass: { // Ø§Ù„ØµÙ Ø§Ù„Ø°ÙŠ ØªÙ†ØªÙ…ÙŠ Ø¥Ù„ÙŠÙ‡ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©
        type: mongoose.Schema.Types.ObjectId,
        ref: 'Class',
        required: true
    }
}, { timestamps: true });

const Class = mongoose.model('Class', classSchema);
const Lecture = mongoose.model('Lecture', lectureSchema);

module.exports = { Class, Lecture };
```

---

### **Ø§Ù„Ø¬Ø²Ø¡ 3: Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Google Drive API**

Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ Ù‡Ùˆ Ø§Ù„Ø£ÙƒØ«Ø± ØªØ¹Ù‚ÙŠØ¯Ù‹Ø§ Ù‚Ù„ÙŠÙ„Ø§Ù‹. Ø³Ù†Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªÙ‡ÙŠØ¦Ø© Google Drive API ÙˆØ¥Ù†Ø´Ø§Ø¡ ÙˆØ¸Ø§Ø¦Ù Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„Ø¨Ø­Ø« Ø¹Ù†Ù‡Ø§.

#### 3.1. Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Refresh Token (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·):

Ø£Ù†Ø´Ø¦ Ù…Ù„ÙØ§Ù‹ Ù…Ù†ÙØµÙ„Ø§Ù‹ Ù„Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù€ `GOOGLE_DRIVE_REFRESH_TOKEN`.
Ø³Ù…ÙŠÙ‡ `getRefreshToken.js`:

```javascript
// getRefreshToken.js
require('dotenv').config();
const { google } = require('googleapis');
const express = require('express');
const app = express();
const port = 3000; // ØªØ£ÙƒØ¯ Ø£Ù† Ù‡Ø°Ø§ Ù†ÙØ³ Ø§Ù„Ù€ REDIRECT_URI ÙÙŠ Google Cloud Console

const CLIENT_ID = process.env.GOOGLE_DRIVE_CLIENT_ID;
const CLIENT_SECRET = process.env.GOOGLE_DRIVE_CLIENT_SECRET;
const REDIRECT_URI = process.env.GOOGLE_DRIVE_REDIRECT_URI; // ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† http://localhost:3000/oauth2callback Ø£Ùˆ Ø§Ù„Ù…Ù†ÙØ° Ø§Ù„Ø°ÙŠ Ø§Ø®ØªØ±ØªÙ‡

const oAuth2Client = new google.auth.OAuth2(
    CLIENT_ID,
    CLIENT_SECRET,
    REDIRECT_URI
);

const authUrl = oAuth2Client.generateAuthUrl({
    access_type: 'offline', // Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ refresh token
    scope: ['https://www.googleapis.com/auth/drive'],
});

console.log('Open this URL in your browser to authorize the app:', authUrl);

app.get('/oauth2callback', async (req, res) => {
    const { code } = req.query;
    if (!code) {
        return res.status(400).send('No authorization code provided.');
    }

    try {
        const { tokens } = await oAuth2Client.getToken(code);
        oAuth2Client.setCredentials(tokens);
        console.log('Successfully authorized!');
        console.log('Your Refresh Token:', tokens.refresh_token);
        res.send('Authorization successful! Your refresh token has been logged to the console. Please add it to your .env file.');
        process.exit(); // Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¨Ø¹Ø¯ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù€ token
    } catch (error) {
        console.error('Error retrieving access token:', error);
        res.status(500).send('Error during authorization.');
    }
});

app.listen(port, () => {
    console.log(`Server listening on port ${port}`);
});

// Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ´ØºÙŠÙ„:
// 1. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† REDIRECT_URI ÙÙŠ .env Ùˆ Google Cloud Console Ù‡Ùˆ http://localhost:3000/oauth2callback (Ø£Ùˆ Ø§Ù„Ù…Ù†ÙØ° Ø§Ù„Ø°ÙŠ Ø§Ø®ØªØ±ØªÙ‡).
// 2. npm install express
// 3. node getRefreshToken.js
// 4. Ø§ØªØ¨Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°ÙŠ ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„ØŒ Ù‚Ù… Ø¨Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©.
// 5. Ø³ØªØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ http://localhost:3000/oauth2callbackØŒ ÙˆØ³ÙŠØ¸Ù‡Ø± Ø§Ù„Ù€ token ÙÙŠ Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„.
// 6. Ø§Ù†Ø³Ø® Ø§Ù„Ù€ CLIENT_ID, CLIENT_SECRET, REDIRECT_URI, Ùˆ REFRESH_TOKEN Ø¥Ù„Ù‰ Ù…Ù„Ù .env Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ø¯ÙŠÙƒ.
// 7. Ø§Ø­Ø°Ù `getRefreshToken.js` Ø£Ùˆ Ù„Ø§ ØªØ´ØºÙ„Ù‡ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
```

#### 3.2. Ø®Ø¯Ù…Ø© Google Drive ÙÙŠ Ø§Ù„Ø¨ÙˆØª:

Ø£Ù†Ø´Ø¦ Ù…Ù„ÙØ§Ù‹ Ø¨Ø§Ø³Ù… `utils/googleDrive.js`:

```javascript
// utils/googleDrive.js
require('dotenv').config();
const { google } = require('googleapis');
const fs = require('fs');
const readline = require('readline'); // Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª ÙƒÙ€ streams

const CLIENT_ID = process.env.GOOGLE_DRIVE_CLIENT_ID;
const CLIENT_SECRET = process.env.GOOGLE_DRIVE_CLIENT_SECRET;
const REDIRECT_URI = process.env.GOOGLE_DRIVE_REDIRECT_URI;
const REFRESH_TOKEN = process.env.GOOGLE_DRIVE_REFRESH_TOKEN;
const GOOGLE_DRIVE_FOLDER_ID = process.env.GOOGLE_DRIVE_FOLDER_ID;

const oAuth2Client = new google.auth.OAuth2(
    CLIENT_ID,
    CLIENT_SECRET,
    REDIRECT_URI
);

oAuth2Client.setCredentials({ refresh_token: REFRESH_TOKEN });

const drive = google.drive({ version: 'v3', auth: oAuth2Client });

// Ø±ÙØ¹ Ù…Ù„Ù Ø¥Ù„Ù‰ Google Drive
async function uploadFile(filePath, fileName, mimeType) {
    try {
        const response = await drive.files.create({
            requestBody: {
                name: fileName,
                parents: [GOOGLE_DRIVE_FOLDER_ID],
            },
            media: {
                mimeType: mimeType,
                body: fs.createReadStream(filePath),
            },
            fields: 'id,webViewLink', // Ù„Ø·Ù„Ø¨ ID ÙˆØ±Ø§Ø¨Ø· Ø§Ù„Ø¹Ø±Ø¶
        });
        console.log('File uploaded to Google Drive:', response.data.id);
        return {
            id: response.data.id,
            link: response.data.webViewLink,
        };
    } catch (error) {
        console.error('Error uploading file to Google Drive:', error);
        throw error;
    }
}

// ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù Ù…Ù† Google Drive ÙˆØ¥Ø¹Ø§Ø¯ØªÙ‡ ÙƒÙ€ ReadStream
async function downloadFile(fileId) {
    try {
        const response = await drive.files.get(
            { fileId: fileId, alt: 'media' },
            { responseType: 'stream' }
        );
        return response.data;
    } catch (error) {
        console.error('Error downloading file from Google Drive:', error);
        throw error;
    }
}

// Ø­Ø°Ù Ù…Ù„Ù Ù…Ù† Google Drive
async function deleteFile(fileId) {
    try {
        await drive.files.delete({ fileId: fileId });
        console.log(`File with ID ${fileId} deleted from Google Drive.`);
        return true;
    } catch (error) {
        console.error('Error deleting file from Google Drive:', error);
        throw error;
    }
}

module.exports = { uploadFile, downloadFile, deleteFile };
```

---

### **Ø§Ù„Ø¬Ø²Ø¡ 4: Ø§Ù„Ø¨ÙˆØª (Telegraf Logic)**

Ø§Ù„Ø¢Ù† Ù†Ø£ØªÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£Ù‡Ù…ØŒ Ø¨ÙˆØª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù….

Ø£Ù†Ø´Ø¦ Ù…Ù„ÙØ§Ù‹ Ø¨Ø§Ø³Ù… `bot.js` ÙÙŠ Ø¬Ø°Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:

```javascript
// bot.js
require('dotenv').config();
const { Telegraf, Markup } = require('telegraf');
const mongoose = require('mongoose');
const { Class, Lecture } = require('./models');
const { uploadFile, downloadFile, deleteFile } = require('./utils/googleDrive');
const fs = require('fs');
const path = require('path');

const bot = new Telegraf(process.env.BOT_TOKEN);
const ADMIN_ID = parseInt(process.env.ADMIN_TELEGRAM_ID); // ØªØ£ÙƒØ¯ Ø£Ù†Ù‡ Ø±Ù‚Ù…

// Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù… (Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø£Ø¯Ù…Ù† Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù€ CRUD)
const userStates = new Map(); // Map<userId, { state: string, currentClassId: string/null, currentLectureId: string/null }>

// Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
mongoose.connect(process.env.MONGO_URI)
    .then(() => console.log('Connected to MongoDB!'))
    .catch(err => console.error('Could not connect to MongoDB', err));

// ÙˆØ³ÙŠØ· (Middleware) Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØ© Ø§Ù„Ø£Ø¯Ù…Ù†
const isAdmin = (ctx, next) => {
    if (ctx.from.id === ADMIN_ID) {
        return next();
    }
    ctx.reply('Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù‡Ø°Ù‡ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·.');
};

// ======================================
// Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
// ======================================

const getMainAdminKeyboard = () => {
    return Markup.inlineKeyboard([
        [Markup.button.callback('Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙˆÙ ğŸ“š', 'admin_manage_classes')],
        [Markup.button.callback('Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ğŸ ', 'admin_main_menu')],
    ]);
};

const getClassesKeyboard = async (prefix = 'class_') => {
    const classes = await Class.find().sort({ name: 1 });
    if (classes.length === 0) {
        return Markup.inlineKeyboard([
             [Markup.button.callback('Ø¥Ù†Ø´Ø§Ø¡ ØµÙ Ø¬Ø¯ÙŠØ¯ â•', 'admin_add_class')]
        ]);
    }
    const buttons = classes.map(c => [Markup.button.callback(c.name, `${prefix}${c._id.toString()}`)]);
    buttons.push([Markup.button.callback('Ø¥Ù†Ø´Ø§Ø¡ ØµÙ Ø¬Ø¯ÙŠØ¯ â•', 'admin_add_class')]);
    buttons.push([Markup.button.callback('Ø§Ù„Ø¹ÙˆØ¯Ø© ğŸ”™', 'admin_manage_classes')]); // Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø©
    return Markup.inlineKeyboard(buttons);
};

const getClassActionsKeyboard = (classId) => {
    return Markup.inlineKeyboard([
        [Markup.button.callback('Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª ğŸ“–', `admin_manage_lectures_${classId}`)],
        [Markup.button.callback('ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„ØµÙ âœï¸', `admin_edit_class_name_${classId}`)],
        [Markup.button.callback('Ø­Ø°Ù Ø§Ù„ØµÙ ğŸ—‘ï¸', `admin_delete_class_confirm_${classId}`)],
        [Markup.button.callback('Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙÙˆÙ ğŸ”™', 'admin_manage_classes')]
    ]);
};

const getLecturesKeyboard = async (classId, prefix = 'lecture_') => {
    const cls = await Class.findById(classId).populate('lectures');
    if (!cls || cls.lectures.length === 0) {
        return Markup.inlineKeyboard([
            [Markup.button.callback('Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø© â•', `admin_add_lecture_${classId}`)],
            [Markup.button.callback('Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙ ğŸ”™', `admin_class_actions_${classId}`)]
        ]);
    }
    const buttons = cls.lectures.map(lec => [Markup.button.callback(lec.name, `${prefix}${lec._id.toString()}`)]);
    buttons.push([Markup.button.callback('Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø© â•', `admin_add_lecture_${classId}`)]);
    buttons.push([Markup.button.callback('Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙ ğŸ”™', `admin_class_actions_${classId}`)]);
    return Markup.inlineKeyboard(buttons);
};

const getLectureActionsKeyboard = (lectureId, classId) => {
    return Markup.inlineKeyboard([
        [Markup.button.callback('ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© âœï¸', `admin_edit_lecture_name_${lectureId}`)],
        [Markup.button.callback('Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© ğŸ—‘ï¸', `admin_delete_lecture_confirm_${lectureId}`)],
        [Markup.button.callback('Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª ğŸ”™', `admin_manage_lectures_${classId}`)]
    ]);
};

// Ù„ÙˆØ­Ø© Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ†
const getUserClassesKeyboard = async () => {
    const classes = await Class.find().sort({ name: 1 });
    if (classes.length === 0) {
        return Markup.inlineKeyboard([
            [Markup.button.callback('Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙÙˆÙ Ø­Ø§Ù„ÙŠØ§Ù‹', 'no_classes_msg')]
        ]);
    }
    const buttons = classes.map(c => [Markup.button.callback(c.name, `view_class_lectures_${c._id.toString()}`)]);
    return Markup.inlineKeyboard(buttons);
};

const getUserLecturesKeyboard =


///////////////////////////////////////////////////////////////


Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ Ù…Ø¬Ø¯Ø¯Ù‹Ø§! ÙŠØ§ Ù‡Ù„Ø§ ÙˆØ§Ù„Ù„Ù‡! ğŸ˜‰

Ø¨Ø§Ù„ØªØ£ÙƒÙŠØ¯ØŒ Ù„Ù†ÙƒÙ…Ù„ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¨ÙˆØª. Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚ ÙˆØ¶Ø¹Ù†Ø§ Ø§Ù„Ø£Ø³Ø§Ø³Ø§ØªØŒ Ø§Ù„Ø¢Ù† Ø³Ù†ÙƒÙ…Ù„ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨ÙˆØª (Telegraf Logic) ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© (State Management) ÙˆØ§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†.

**ØªÙƒÙ…Ù„Ø© Ø§Ù„Ø¬Ø²Ø¡ 4: Ø§Ù„Ø¨ÙˆØª (Telegraf Logic)**

---

```javascript
// bot.js (ØªÙƒÙ…Ù„Ø©)

// ... (Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯: dotenv, telegraf, mongoose, googleDrive, isAdmin middleware) ...

// -------------------------------------
// Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¨ÙˆØª (User States)
// -------------------------------------
// Ù†Ø³ØªØ®Ø¯Ù… Map Ù„ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ù„ØªØ³Ù‡ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù€ CRUD
// Ù…Ø«Ø§Ù„:
// userStates = {
//   userId1: { state: 'awaiting_class_name' },
//   userId2: { state: 'awaiting_lecture_name', parentClass: 'class_id_abc' },
//   userId3: { state: 'awaiting_file_upload', parentClass: 'class_id_xyz' }
// }

// -------------------------------------
// Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø¨ÙˆØª
// -------------------------------------

// Ø§Ù„Ø£Ù…Ø± /start
bot.start(async (ctx) => {
    const userId = ctx.from.id;
    const userName = ctx.from.first_name;

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ Ø§Ù„Ø£Ø¯Ù…Ù†
    if (userId === ADMIN_ID) {
        userStates.delete(userId); // Ù…Ø³Ø­ Ø£ÙŠ Ø­Ø§Ù„Ø© Ø³Ø§Ø¨Ù‚Ø© Ù„Ù„Ø£Ø¯Ù…Ù†
        ctx.reply(`Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ø¯ÙŠØ±! ğŸ‘‹\nÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙˆÙ ÙˆØ§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªØ§Ù„ÙŠØ©:`, getMainAdminKeyboard());
    } else {
        // Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ†: Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙÙˆÙ
        userStates.delete(userId); // Ù…Ø³Ø­ Ø£ÙŠ Ø­Ø§Ù„Ø© Ø³Ø§Ø¨Ù‚Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const keyboard = await getUserClassesKeyboard();
        ctx.reply(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${userName}! ğŸ‘‹\nÙ‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©. Ø§Ø®ØªØ± Ø§Ù„ØµÙ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯Ù‡:`, keyboard);
    }
});

// -------------------------------------
// Ø£ÙˆØ§Ù…Ø± ÙˆÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø¯Ù…Ù† (CRUD Operations)
// -------------------------------------

// -------------- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙˆÙ (Classes) --------------

// Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ¶Ø¹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙˆÙ
bot.action('admin_manage_classes', isAdmin, async (ctx) => {
    userStates.delete(ctx.from.id); // Ù…Ø³Ø­ Ø£ÙŠ Ø­Ø§Ù„Ø© Ø³Ø§Ø¨Ù‚Ø©
    ctx.editMessageText('Ø§Ø®ØªØ± Ø§Ù„ØµÙ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø¥Ø¯Ø§Ø±ØªÙ‡ Ø£Ùˆ Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ ØµÙ Ø¬Ø¯ÙŠØ¯:', await getClassesKeyboard());
});

// Ø¥Ù†Ø´Ø§Ø¡ ØµÙ Ø¬Ø¯ÙŠØ¯ (Ù…Ø±Ø­Ù„Ø© 1: Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³Ù…)
bot.action('admin_add_class', isAdmin, async (ctx) => {
    userStates.set(ctx.from.id, { state: 'awaiting_class_name' });
    ctx.editMessageText('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ØµÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯:', Markup.inlineKeyboard([Markup.button.callback('Ø¥Ù„ØºØ§Ø¡ âŒ', 'admin_manage_classes')]));
});

// Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ØµÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2)
bot.on('text', isAdmin, async (ctx) => { // Ù†Ø³ØªØ®Ø¯Ù… on('text') Ù„Ø£Ù†Ù‡ ÙŠØ¹Ø§Ù„Ø¬ Ø£ÙŠ Ù†Øµ
    const userId = ctx.from.id;
    const text = ctx.message.text;
    const state = userStates.get(userId);

    if (state && state.state === 'awaiting_class_name') {
        try {
            const newClass = new Class({ name: text });
            await newClass.save();
            userStates.delete(userId); // ØªÙ… Ø§Ù„Ø­ÙØ¸ØŒ Ø§Ù…Ø³Ø­ Ø§Ù„Ø­Ø§Ù„Ø©
            ctx.reply(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙ "${text}" Ø¨Ù†Ø¬Ø§Ø­! âœ…`);
            ctx.reply('Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:', await getClassesKeyboard()); // Ø§Ø¹Ø±Ø¶ Ø§Ù„Ù„Ø§Ø¦Ø­Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
        } catch (error) {
            console.error("Error creating class:", error);
            if (error.code === 11000) { // Duplicate key error
                ctx.reply('Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù„Ù„ØµÙ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³Ù… Ø¢Ø®Ø±.', Markup.inlineKeyboard([Markup.button.callback('Ø¥Ù„ØºØ§Ø¡ âŒ', 'admin_manage_classes')]));
            } else {
                ctx.reply('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙ. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
            }
        }
    } else if (state && state.state === 'awaiting_lecture_name') {
        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø³Ù†Ø¹Ø§Ù„Ø¬Ù‡ ÙÙŠ Ø¬Ø²Ø¡ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª)
        // Ù‡Ø°Ù‡ Ù„ÙŠØ³Øª Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø«Ù„Ù‰ØŒ Ø³Ù†Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„ Ù„Ø§Ø­Ù‚Ø§Ù‹
        // Ø§Ù„Ø¢Ù†ØŒ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø³Ù… Ù…Ø­Ø§Ø¶Ø±Ø©ØŒ ÙÙ‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù†Ù‡ Ø£Ø±Ø³Ù„ Ù†ØµÙ‹Ø§ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ù…Ù„Ù
        ctx.reply('Ù„Ù„Ø£Ø³ÙØŒ ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ù…Ø¨Ø§Ø´Ø±Ø©. Ø£Ø±Ø³Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ØªØ£ÙƒØ¯Ø§Ù‹ØŒ ÙˆØ³Ø£Ø­Ø§ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù.');
        // ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ† Ù‡Ø°Ø§ Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø­Ø§Ù„Ø© "Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ©"
    } else if (state && state.state === 'editing_class_name') {
        try {
            const classId = state.currentClassId;
            const updatedClass = await Class.findByIdAndUpdate(classId, { name: text }, { new: true });
            if (updatedClass) {
                ctx.reply(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„ØµÙ Ø¥Ù„Ù‰ "${text}". âœ…`);
                userStates.delete(userId);
                ctx.reply('Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:', await getClassesKeyboard());
            } else {
                ctx.reply('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ Ù„ØªØ¹Ø¯ÙŠÙ„Ù‡.');
                userStates.delete(userId);
            }
        } catch (error) {
            console.error("Error editing class name:", error);
            ctx.reply('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„ØµÙ. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
        }
    } else if (state && state.state === 'editing_lecture_name') {
        try {
            const lectureId = state.currentLectureId;
            const classId = state.parentClass; // Ù†Ø­ØªØ§Ø¬ Ù…Ø¹Ø±Ù Ø§Ù„ØµÙ Ø§Ù„Ø£Ù…
            const updatedLecture = await Lecture.findByIdAndUpdate(lectureId, { name: text }, { new: true });
            if (updatedLecture) {
                ctx.reply(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø¥Ù„Ù‰ "${text}". âœ…`);
                userStates.delete(userId);
                ctx.editMessageText(`Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¥Ø¯Ø§Ø±ØªÙ‡Ø§:`, await getLecturesKeyboard(classId));
            } else {
                ctx.reply('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ù„ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§.');
                userStates.delete(userId);
            }
        } catch (error) {
            console.error("Error editing lecture name:", error);
            ctx.reply('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
        }
    } else if (state && state.state === 'awaiting_file_upload') {
         ctx.reply('Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø§Ù„Ø©. ÙŠØ¨Ø¯Ùˆ Ø£Ù†Ùƒ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù…Ù„ÙØŒ ÙˆÙ„ÙƒÙ†Ùƒ Ø£Ø±Ø³Ù„Øª Ù†ØµÙ‹Ø§. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø©.');
    } else {
        // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„ØªÙŠ Ù„Ø§ ØªØªØ¹Ù„Ù‚ Ø¨Ø£Ù…Ø± Ø­Ø§Ù„ÙŠ
        // Ø£Ùˆ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ù„Ø£ÙˆØ§Ù…Ø± Ø£Ø®Ø±Ù‰ Ù…Ø³ØªÙ‚Ø¨Ù„Ù‹Ø§
    }
});


// Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø²Ø± Ø§Ø®ØªÙŠØ§Ø± ØµÙ Ù…Ø¹ÙŠÙ†
bot.action(/^class_([a-f0-9]{24})$/, isAdmin, async (ctx) => {
    const classId = ctx.match[1]; // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù€ ID Ù…Ù† Ø§Ù„Ù†Ù…Ø·
    userStates.delete(ctx.from.id); // Ù…Ø³Ø­ Ø£ÙŠ Ø­Ø§Ù„Ø© Ù„Ø¬Ø¹Ù„ Ø§Ù„ØµÙØ­Ø© Ù†Ø¸ÙŠÙØ©
    ctx.editMessageText('Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ ØªÙ†ÙÙŠØ°Ù‡ Ù„Ù‡Ø°Ø§ Ø§Ù„ØµÙ:', await getClassActionsKeyboard(classId));
});

// ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„ØµÙ (Ù…Ø±Ø­Ù„Ø© 1: Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±)
bot.action(/^admin_edit_class_name_([a-f0-9]{24})$/, isAdmin, async (ctx) => {
    const classId = ctx.match[1];
    userStates.set(ctx.from.id, { state: 'editing_class_name', currentClassId: classId });
    ctx.editMessageText('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØµÙ:', Markup.inlineKeyboard([Markup.button.callback('Ø¥Ù„ØºØ§Ø¡ âŒ', `admin_class_actions_${classId}`)]));
});

// ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„ØµÙ (Ù…Ø±Ø­Ù„Ø© 1: Ø·Ù„Ø¨ Ø§Ù„ØªØ£ÙƒÙŠØ¯)
bot.action(/^admin_delete_class_confirm_([a-f0-9]{24})$/, isAdmin, async (ctx) => {
    const classId = ctx.match[1];
    ctx.editMessageText('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙ ÙˆØ¬Ù…ÙŠØ¹ Ù…Ø­Ø§Ø¶Ø±Ø§ØªÙ‡ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.', Markup.inlineKeyboard([
        [Markup.button.callback('Ù†Ø¹Ù…ØŒ Ø¨Ø§Ù„ØªØ£ÙƒÙŠØ¯ ğŸ—‘ï¸', `admin_delete_class_${classId}`)],
        [Markup.button.callback('Ù„Ø§ØŒ Ø¥Ù„ØºØ§Ø¡ âŒ', `admin_class_actions_${classId}`)]
    ]));
});

// ØªÙ†ÙÙŠØ° Ø­Ø°Ù Ø§Ù„ØµÙ (Ù…Ø±Ø­Ù„Ø© 2: Ø§Ù„Ø­Ø°Ù Ø§Ù„ÙØ¹Ù„ÙŠ)
bot.action(/^admin_delete_class_([a-f0-9]{24})$/, isAdmin, async (ctx) => {
    const classId = ctx.match[1];
    try {
        // 1. Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„ØµÙ
        const cls = await Class.findById(classId).populate('lectures');
        if (!cls) {
            return ctx.reply('Ø§Ù„ØµÙ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.', getMainAdminKeyboard());
        }

        // 2. Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ù…Ù† Google Drive ÙˆÙ‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        for (const lecture of cls.lectures) {
            await deleteFile(lecture.googleDriveId);
            await Lecture.findByIdAndDelete(lecture._id);
        }

        // 3. Ø­Ø°Ù Ø§Ù„ØµÙ Ù†ÙØ³Ù‡ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        await Class.findByIdAndDelete(classId);

        ctx.reply(`ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙ "${cls.name}" ÙˆØ¬Ù…ÙŠØ¹ Ù…Ø­Ø§Ø¶Ø±Ø§ØªÙ‡ Ø¨Ù†Ø¬Ø§Ø­. âœ…`);
        ctx.reply('Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:', await getClassesKeyboard()); // Ø¹Ø±Ø¶ Ø§Ù„Ù„Ø§Ø¦Ø­Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
    } catch (error) {
        console.error("Error deleting class:", error);
        ctx.reply('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„ØµÙ. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
    }
});


// -------------- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª (Lectures) --------------

// Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ¶Ø¹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ù„ØµÙ Ù…Ø¹ÙŠÙ†
bot.action(/^admin_manage_lectures_([a-f0-9]{24})$/, isAdmin, async (ctx) => {
    const classId = ctx.match[1];
    userStates.delete(ctx.from.id); // Ù…Ø³Ø­ Ø£ÙŠ Ø­Ø§Ù„Ø©
    ctx.editMessageText('Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¥Ø¯Ø§Ø±ØªÙ‡Ø§ Ø£Ùˆ Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©:', await getLecturesKeyboard(classId));
});

// Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø²Ø± Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­Ø§Ø¶Ø±Ø© Ù…Ø¹ÙŠÙ†Ø©
bot.action(/^lecture_([a-f0-9]{24})$/, isAdmin, async (ctx) => {
    const lectureId = ctx.match[1];
    // Ù†Ø­ØªØ§Ø¬ Ù„Ù…Ø¹Ø±ÙØ© Ø£ÙŠ ØµÙ Ù‡Ùˆ Ø§Ù„Ø£Ø¨ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©
    const lecture = await Lecture.findById(lectureId);
    if (!lecture) {
        return ctx.reply('Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©.');
    }
    const classId = lecture.parentClass.toString(); // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ID Ø§Ù„ØµÙ Ø§Ù„Ø£Ø¨

    userStates.delete(ctx.from.id); // Ù…Ø³Ø­ Ø£ÙŠ Ø­Ø§Ù„Ø©
    ctx.editMessageText('Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ ØªÙ†ÙÙŠØ°Ù‡ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©:', getLectureActionsKeyboard(lectureId, classId));
});


// Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø© (Ù…Ø±Ø­Ù„Ø© 1: ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙ ÙˆØ¥Ø¹Ø¯Ø§Ø¯ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±)
bot.action(/^admin_add_lecture_([a-f0-9]{24})$/, isAdmin, async (ctx) => {
    const classId = ctx.match[1];
    const cls = await Class.findById(classId);
    if (!cls) {
        return ctx.reply('Ø§Ù„ØµÙ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.');
    }
    userStates.set(ctx.from.id, { state: 'awaiting_file_upload', parentClass: classId });
    ctx.editMessageText(`Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ù…Ø­Ø§Ø¶Ø±Ø© "${cls.name}".\n*Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ§Ø³Ù… Ù„Ù„Ù…Ø­Ø§Ø¶Ø±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.*`, Markup.inlineKeyboard([
        [Markup.button.callback('Ø¥Ù„ØºØ§Ø¡ âŒ', `admin_manage_lectures_${classId}`)]
    ]));
});


// Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª (Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø°ÙŠ Ø³ÙŠØªÙ… ÙÙŠÙ‡ Ø§Ù„Ø±ÙØ¹ Ù„Ù€ Drive)
bot.on(['document', 'video', 'audio', 'photo'], isAdmin, async (ctx) => {
    const userId = ctx.from.id;
    const state = userStates.get(userId);

    // Ù†ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø£Ø¯Ù…Ù† ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù†ØªØ¸Ø§Ø± Ù…Ù„Ù
    if (!state || state.state !== 'awaiting_file_upload' || !state.parentClass) {
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† ÙÙŠ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©ØŒ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ù‚Ù… Ø¨Ø¥Ø¬Ø±Ø§Ø¡ Ø¢Ø®Ø±
        // Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù‡Ø°Ø§ Ù…Ù„Ù ØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡ Ø¨Ø§Ù„Ø®Ø·Ø£ØŒ Ø£Ùˆ ÙÙŠ Ø³ÙŠØ§Ù‚ Ø¢Ø®Ø±
        // for example: ctx.reply("Please use the correct command to upload files.");
        return;
    }

    const classId = state.parentClass;
    let fileId, fileName, fileMimeType, fileStream, fileSize;

    // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰
    if (ctx.message.document) {
        fileId = ctx.message.document.file_id;
        fileName = ctx.message.document.file_name;
        fileMimeType = ctx.message.document.mime_type;
        fileSize = ctx.message.document.file_size;
    } else if (ctx.message.photo) { // Ø§Ù„ØµÙˆØ± ØªØ±Ø³Ù„ ÙƒÙ€ photo, Ù†Ø£Ø®Ø° Ø§Ù„Ø£ÙƒØ¨Ø±
        fileId = ctx.message.photo[ctx.message.photo.length - 1].file_id;
        fileName = `${fileId}.jpg`; // Ø§Ø³Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„ØµÙˆØ±
        fileMimeType = 'image/jpeg';
        // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ù‡Ù†Ø§ Ø¨Ø´ÙƒÙ„ Ø³Ù‡Ù„ØŒ Ùˆ telegraf Ù„Ø§ ÙŠÙˆÙØ± stream Ù„Ù„ØµÙˆØ±
        // Ø³Ù†Ø­Ø§ÙˆÙ„ ØªÙ†Ø²ÙŠÙ„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§ØŒ ÙˆØ¥Ø°Ø§ ÙØ´Ù„ØŒ Ø³Ù†Ø®Ø¨Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    } else if (ctx.message.video) {
        fileId = ctx.message.video.file_id;
        fileName = ctx.message.video.file_name || `${fileId}.mp4`;
        fileMimeType = ctx.message.video.mime_type || 'video/mp4';
        fileSize = ctx.message.video.file_size;
    } else if (ctx.message.audio) {
        fileId = ctx.message.audio.file_id;
        fileName = ctx.message.audio.file_name || `${fileId}.mp3`;
        fileMimeType = ctx.message.audio.mime_type || 'audio/mpeg';
        fileSize = ctx.message.audio.file_size;
    }

    // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡
    if (!fileId) {
        ctx.reply('Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… Ø­Ø§Ù„ÙŠÙ‹Ø§.');
        return;
    }

    // Ø¥Ø¹Ø·Ø§Ø¡ Ø±Ø¯ ÙÙˆØ±ÙŠ Ù„Ù„Ù…Ø¯ÙŠØ± Ø¨Ø£Ù†Ù†Ø§ Ù†Ø³ØªÙ„Ù… Ø§Ù„Ù…Ù„Ù
    const loadingMsg = await ctx.reply(`Ø¬Ø§Ø±Ù Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ù„Ù "${fileName}"...`);

    try {
        // 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ù…Ù† Telegram Ø¥Ù„Ù‰ Ø®Ø§Ø¯Ù…Ùƒ Ù…Ø¤Ù‚ØªÙ‹Ø§
        const telegramFile = await ctx.telegram.getFile(fileId);
        const telegramFileUrl = `https://api.telegram.org/file/bot${process.env.BOT_TOKEN}/${telegramFile.file_path}`;

        // Ù†Ø³ØªØ®Ø¯Ù… fs.createWriteStream Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¤Ù‚Øª
        const tempFilePath = path.join(__dirname, 'temp_uploads', fileName);
        if (!fs.existsSync(path.join(__dirname, 'temp_uploads'))) {
            fs.mkdirSync(path.join(__dirname, 'temp_uploads'));
        }
        const writer = fs.createWriteStream(tempFilePath);

        await new Promise((resolve, reject) => {
            require('axios')({ // Ø§Ø³ØªØ®Ø¯Ø§Ù… axios Ù„ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
                method: 'get',
                url: telegramFileUrl,
                responseType: 'stream'
            })
            .then(response => {
                response.data.pipe(writer);
                writer.on('finish', resolve);
                writer.on('error', (err) => reject(`Error writing file stream: ${err}`));
            })
            .catch(err => reject(`Axios download error: ${err}`));
        });

        // 2. Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¤Ù‚Øª Ø¥Ù„Ù‰ Google Drive
        const driveFileInfo = await uploadFile(tempFilePath, fileName, fileMimeType);

        // 3. Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const newLecture = new Lecture({
            name: fileName, // Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ù‡Ùˆ Ø§Ø³Ù…Ù‡Ø§ Ø§Ù„Ø£ØµÙ„ÙŠ
            originalFileName: fileName,
            googleDriveId: driveFileInfo.id,
            googleDriveLink: driveFileInfo.link,
            parentClass: classId
        });
        await newLecture.save();

        // 4. Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„ØµÙ Ø§Ù„Ù…Ø±ØªØ¨Ø·
        await Class.findByIdAndUpdate(classId, { $push: { lectures: newLecture._id } });

        // 5. Ù…Ø³Ø­ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
        userStates.delete(userId);

        // 6. Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¤Ù‚Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
        fs.unlink(tempFilePath, (err) => {
            if (err) console.error(`Error deleting temporary file ${tempFilePath}:`, err);
        });

        // 7. Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­ Ù„Ù„Ù…Ø¯ÙŠØ±
        await ctx.telegram.